THREAD FLOW DIAGRAM: Quality Preset + Zoom Crash
================================================

TIMELINE: Events from left to right
THREADS: MainThread (top), Timer Thread (bottom)


Step 1: User Changes Preset
============================

[MainThread] â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
              â”‚
              â”œâ”€ User clicks "High Quality" preset
              â”‚
              â”œâ”€ _on_preset_change('high_quality')
              â”‚  â”œâ”€ state.current_preset_name = 'high_quality'
              â”‚  â”œâ”€ renderer.set_config(RenderConfig.high_quality())
              â”‚  â””â”€ _update_display(force_render=True)
              â”‚
              â”œâ”€ state.saved_preset_name = None
              â”‚
              v


Step 2: User Scrolls to Zoom
=============================

[MainThread] â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
              â”‚
              â”œâ”€ User scrolls mouse wheel
              â”‚
              â”œâ”€ _on_scroll(event)
              â”‚  â”‚
              â”‚  â”œâ”€ auto_quality_enabled == True
              â”‚  â”‚
              â”‚  â”œâ”€ _switch_to_interaction_quality()
              â”‚  â”‚  â”œâ”€ state.saved_preset_name = 'high_quality'  â† SAVED
              â”‚  â”‚  â”œâ”€ state.current_preset_name = 'fast'
              â”‚  â”‚  â””â”€ renderer.set_config(RenderConfig.fast())
              â”‚  â”‚
              â”‚  â”œâ”€ camera_controller.zoom(factor)
              â”‚  â”‚
              â”‚  â”œâ”€ _update_display()
              â”‚  â”‚
              â”‚  â””â”€ threading.Timer(0.5, callback).start()  â† TIMER CREATED
              â”‚     â”‚
              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                           â”‚
              v                           â”‚
                                          â”‚
          (User sees fast quality)       â”‚
          (0.5 seconds pass...)          â”‚
                                          â”‚
                                          â”‚
Step 3: Timer Fires (0.5s later)        â”‚
================================        â”‚
                                          â”‚
[MainThread] â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
              (idle)                     â”‚
                                          â”‚
[Timer Thread] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<â”€â”˜  â† THREAD SWITCH! âŒ
              â”‚
              â”œâ”€ _restore_quality_after_interaction()  â† BACKGROUND THREAD!
              â”‚  â”‚
              â”‚  â”œâ”€ restored_config = RenderConfig.high_quality()  âœ“ OK
              â”‚  â”‚
              â”‚  â”œâ”€ renderer.set_config(restored_config)  âš ï¸ May be unsafe
              â”‚  â”‚
              â”‚  â”œâ”€ preset_selector.set_preset('high_quality')  âŒ DANGER!
              â”‚  â”‚  â”‚
              â”‚  â”‚  â””â”€ radio.set_active(3)  âŒ GUI MODIFICATION FROM WRONG THREAD
              â”‚  â”‚     â”‚
              â”‚  â”‚     â””â”€ Calls into native GUI toolkit (Tk/Qt)
              â”‚  â”‚        â”‚
              â”‚  â”‚        â””â”€ NOT THREAD-SAFE â†’ CRASH! ğŸ’¥
              â”‚  â”‚
              â”‚  â”œâ”€ _update_display(force_render=True)  âŒ DANGER!
              â”‚  â”‚  â”‚
              â”‚  â”‚  â”œâ”€ renderer.render()  âš ï¸ OpenGL from wrong thread
              â”‚  â”‚  â”‚
              â”‚  â”‚  â””â”€ fig.canvas.draw_idle()  âŒ matplotlib draw from wrong thread
              â”‚  â”‚     â”‚
              â”‚  â”‚     â””â”€ Backend GUI operations â†’ CRASH! ğŸ’¥
              â”‚  â”‚
              â”‚  â””â”€ state.saved_preset_name = None
              â”‚
              ğŸ’¥ CRASH (silent window close or exception)
              â”‚
              v


PROBLEM SUMMARY
===============

âŒ threading.Timer callback executes in BACKGROUND THREAD (Thread-1)
âŒ Matplotlib widgets (RadioButtons) modified from background thread
âŒ Matplotlib canvas drawing (draw_idle) called from background thread
âŒ Native GUI toolkits (Tk, Qt) are NOT thread-safe
âŒ Result: Undefined behavior â†’ Silent crash


THREAD OWNERSHIP
================

MAIN THREAD (safe):
  âœ“ All GUI operations (widgets, drawing, events)
  âœ“ Matplotlib figure/axes modifications
  âœ“ OpenGL context operations
  âœ“ User event handlers (_on_scroll, _on_mouse_press, etc.)

BACKGROUND THREAD (UNSAFE):
  âœ“ Pure computation (no GUI)
  âœ“ File I/O (with care)
  âœ“ Network requests (with care)
  âŒ Any matplotlib operations
  âŒ Any GUI widget modifications
  âŒ Any canvas drawing
  âŒ Any OpenGL operations


SOLUTION
========

Replace threading.Timer with matplotlib's native timer:

[MainThread] â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
              â”‚
              â”œâ”€ _on_scroll(event)
              â”‚  â”‚
              â”‚  â””â”€ fig.canvas.new_timer(interval=500)  â† matplotlib timer
              â”‚     â”‚
              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                           â”‚
              v                           â”‚
                                          â”‚
          (0.5 seconds pass...)          â”‚
                                          â”‚
[MainThread] â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
              â”‚                           â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<â”€â”˜  â† STAYS ON MAIN THREAD! âœ“
              â”‚
              â”œâ”€ _restore_quality_after_interaction()  âœ“ MAIN THREAD
              â”‚  â”‚
              â”‚  â”œâ”€ preset_selector.set_preset('high_quality')  âœ“ SAFE
              â”‚  â”‚
              â”‚  â””â”€ _update_display(force_render=True)  âœ“ SAFE
              â”‚
              âœ“ No crash!
              â”‚
              v


CODE LOCATIONS
==============

BUG: pyvr/interface/matplotlib_interface.py:502
    threading.Timer(0.5, self._restore_quality_after_interaction)

BUG: pyvr/interface/matplotlib_interface.py:346
    self.preset_selector.set_preset(self.state.saved_preset_name)

BUG: pyvr/interface/widgets.py:509
    self.radio.set_active(preset_index)


REPRODUCTION
============

Run: python tmp_dev/reproduce_zoom_crash.py
Trace: python tmp_dev/trace_threading_bug.py
