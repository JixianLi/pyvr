# v0.3.2 Interface Relayout Design

## Overview

Redesign the interactive interface layout from 2-column to 3-column format to ensure all information (controls, keyboard shortcuts, and status) is visible by default without truncation.

**Version:** v0.3.2
**Feature:** interface-relayout
**Type:** Enhancement (non-breaking)
**Breaking Changes:** None

## Problem Statement

The current 2-column layout uses a 4-row right panel with height ratios [4, 2, 2, 1]. The bottom info panel (ratio 1) must display ~17 lines of text (mouse controls, keyboard shortcuts, and status), causing truncation on typical displays. This is problematic for a demo interface where all information should be visible by default.

## Design Goals

1. Display all interface information without truncation or scrolling
2. Maintain familiar "image on left, controls on right" pattern
3. Avoid making the interface too tall for typical displays (keep height at 8 inches)
4. Maximize image display space while ensuring controls are usable
5. Zero breaking changes to the API

## Solution: 3-Column Layout

### Layout Architecture

**Column Structure:**
- **Column 1 (left, width ratio 2.5):** Image display spanning full height
- **Column 2 (middle, width ratio 1.0):** Stacked control widgets (opacity, color, preset)
- **Column 3 (right, width ratio 0.8):** Info panel spanning full height

**Figure Dimensions:**
- Change from (14, 8) to (16, 8) inches
- Width increase accommodates 3 columns
- Height remains constant to avoid vertical screen constraints

**GridSpec Configuration:**
```python
gs = GridSpec(3, 3, figure=fig,
             width_ratios=[2.5, 1.0, 0.8],
             height_ratios=[3, 1, 1],
             hspace=0.3, wspace=0.3)
```

**Column Width Ratios Explained:**
- 2.5: Image gets ~58% of width (largest, it's the star of the demo)
- 1.0: Controls get ~23% of width (adequate for interactive widgets)
- 0.8: Info panel gets ~19% of width (sufficient for ~50-60 char text lines)

**Middle Column Height Ratios [3, 1, 1]:**
- 3: Opacity editor (60% of middle column) - needs height for histogram and control points
- 1: Color selector (20% of middle column) - simple dropdown widget
- 1: Preset selector (20% of middle column) - radio button widget

### Axes Mapping

```python
ax_image = fig.add_subplot(gs[:, 0])      # Spans rows 0-2, column 0
ax_opacity = fig.add_subplot(gs[0, 1])    # Row 0, column 1
ax_color = fig.add_subplot(gs[1, 1])      # Row 1, column 1
ax_preset = fig.add_subplot(gs[2, 1])     # Row 2, column 1
ax_info = fig.add_subplot(gs[:, 2])       # Spans rows 0-2, column 2
```

## Implementation Changes

### Modified Method: `_create_layout()`

**File:** `pyvr/interface/matplotlib_interface.py:208-242`

**Current Implementation:**
```python
def _create_layout(self) -> tuple:
    fig = plt.figure(figsize=(14, 8))
    gs = GridSpec(4, 2, figure=fig,
                 width_ratios=[2, 1],
                 height_ratios=[4, 2, 2, 1],
                 hspace=0.3, wspace=0.3)

    ax_image = fig.add_subplot(gs[:, 0])      # Full left column
    ax_opacity = fig.add_subplot(gs[0, 1])    # Top right
    ax_color = fig.add_subplot(gs[1, 1])      # Middle-top right
    ax_preset = fig.add_subplot(gs[2, 1])     # Middle-bottom right
    ax_info = fig.add_subplot(gs[3, 1])       # Bottom right

    return fig, axes_dict
```

**New Implementation:**
```python
def _create_layout(self) -> tuple:
    fig = plt.figure(figsize=(16, 8))
    gs = GridSpec(3, 3, figure=fig,
                 width_ratios=[2.5, 1.0, 0.8],
                 height_ratios=[3, 1, 1],
                 hspace=0.3, wspace=0.3)

    ax_image = fig.add_subplot(gs[:, 0])      # Full left column (all rows)
    ax_opacity = fig.add_subplot(gs[0, 1])    # Top middle
    ax_color = fig.add_subplot(gs[1, 1])      # Middle middle
    ax_preset = fig.add_subplot(gs[2, 1])     # Bottom middle
    ax_info = fig.add_subplot(gs[:, 2])       # Full right column (all rows)

    return fig, axes_dict
```

**Code Comments:**
Add concise comment explaining the layout:
```python
# 3-column layout: image (2.5) | controls (1.0) | info (0.8)
# Info panel spans full height to display all text without truncation
```

### No Other Changes Required

All other code remains unchanged:
- Widget initialization logic identical
- Event handlers unchanged
- Callbacks unchanged
- State management unchanged

## Testing Strategy

### Unit Tests

**New Test File:** `tests/test_interface/test_layout.py`

1. **Test GridSpec dimensions:**
   - Verify 3 rows, 3 columns
   - Verify width_ratios=[2.5, 1.0, 0.8]
   - Verify height_ratios=[3, 1, 1]

2. **Test figure size:**
   - Verify figsize=(16, 8)

3. **Test axes count and keys:**
   - Verify 5 axes returned
   - Verify keys: 'image', 'opacity', 'color', 'preset', 'info'

### Integration Tests

**Update Existing Tests:** `tests/test_interface/test_integration.py`

1. Test complete interface initialization with new layout
2. Test all widgets render correctly
3. Test info panel displays full text without truncation
4. Test mouse/keyboard event handlers still work

### Visual Regression Tests

**Manual Testing Required:**
1. Launch interface and verify all text visible
2. Test on 1920x1080 display (minimum recommended)
3. Test window resize behavior
4. Compare before/after screenshots

### Edge Cases

1. **Small displays (1366x768):** Interface may require window maximization - acceptable for demo interface
2. **High DPI displays:** Matplotlib handles DPI scaling automatically
3. **Font sizing:** Current fontsize=8 remains readable with full-height info column
4. **Text wrapping:** Info text naturally wraps at ~50-60 characters per line

## Backward Compatibility

**API Compatibility:**
- All public methods unchanged
- No parameter changes
- No behavior changes (except visual layout)

**Breaking Changes:**
- None - this is a purely visual enhancement

**Migration Required:**
- None - existing code works unchanged

## Documentation Updates

### 1. Version Notes

**File:** `version_notes/v0.3.2_interface_relayout.md`

Content:
- Document layout change rationale
- Include before/after comparison
- Note figure size increase
- Mention minimum recommended display size (1920x1080+)

### 2. CLAUDE.md

**Updates:**
- Change "Current Version" to v0.3.2
- Add v0.3.2 entry in version history section
- No API changes to document (internal change only)

### 3. Docstrings

**File:** `pyvr/interface/matplotlib_interface.py`

Update `_create_layout()` docstring:
```python
def _create_layout(self) -> tuple:
    """
    Create matplotlib figure layout.

    Uses 3-column layout:
    - Left (2.5): Image display (full height)
    - Middle (1.0): Stacked control widgets
    - Right (0.8): Info panel (full height)

    Returns:
        Tuple of (figure, axes_dict) with keys: 'image', 'opacity', 'color', 'preset', 'info'
    """
```

## Release Checklist

- [ ] Implement layout changes in `_create_layout()`
- [ ] Add layout verification tests
- [ ] Run full test suite (all 361 tests must pass)
- [ ] Manual visual testing on 1920x1080 display
- [ ] Create version notes document
- [ ] Update CLAUDE.md
- [ ] Update docstrings
- [ ] Commit: `feat(interface): Redesign layout to 3-column format for v0.3.2`

## Success Criteria

1. All interface information visible without scrolling/truncation
2. All existing tests pass
3. New layout tests pass
4. Interface usable on 1920x1080+ displays
5. Zero breaking changes to API
