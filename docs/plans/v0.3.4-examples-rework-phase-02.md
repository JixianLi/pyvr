# Phase 02: Create basic_rendering.py

## Scope

Create the minimal pipeline example demonstrating volume creation through rendering and display.

**What will be built:**
- `example/basic_rendering.py` - Minimal complete rendering pipeline
- ~60 lines of heavily commented code
- Single figure output with rendered sphere

**Dependencies:**
- Phase 01 completed (clean example directory)

**Files affected:**
- CREATE: `example/basic_rendering.py`

## Implementation

### Task 1: Create basic_rendering.py file structure
**Action:** Create the file with ABOUTME headers, docstring, and imports.

**File:** `example/basic_rendering.py`

**Content:**
```python
# ABOUTME: Minimal volume rendering pipeline from data creation to display
# ABOUTME: Demonstrates basic PyVR workflow with sphere dataset and default settings

"""
Basic Volume Rendering Example

This example demonstrates the minimal PyVR pipeline:
1. Create a synthetic volume dataset
2. Set up the renderer with a quality preset
3. Configure camera and lighting
4. Apply transfer functions for color and opacity
5. Render and display the result

This is the simplest complete PyVR workflow.
"""

import numpy as np
import matplotlib.pyplot as plt

from pyvr.camera import Camera
from pyvr.config import RenderConfig
from pyvr.datasets import create_sample_volume
from pyvr.lighting import Light
from pyvr.moderngl_renderer import VolumeRenderer
from pyvr.transferfunctions import ColorTransferFunction, OpacityTransferFunction
from pyvr.volume import Volume
```

### Task 2: Add constants and main function signature
**Action:** Define configuration constants at module level.

**Content to add:**
```python
# Rendering parameters
VOLUME_SIZE = 128  # Volume dimensions (128x128x128)
IMAGE_RES = 512    # Output image resolution (512x512 pixels)


def main():
    """Run the basic rendering demo."""
```

### Task 3: Implement volume creation
**Action:** Add volume creation with inline comments.

**Content to add in main():**
```python
    # Step 1: Create a simple sphere volume
    # Using the sphere dataset as it renders quickly and shows basic features
    print("Creating volume data...")
    volume_data = create_sample_volume(VOLUME_SIZE, 'sphere')

    # Wrap the data in a Volume object
    # Volume handles data, bounds, and optional normal vectors
    volume = Volume(data=volume_data)
    print(f"Volume created: {volume.shape}")
```

### Task 4: Implement renderer setup
**Action:** Add renderer initialization with camera and light.

**Content to add in main():**
```python
    # Step 2: Create the renderer
    # Using balanced preset for good quality/performance tradeoff
    print("Setting up renderer...")
    config = RenderConfig.balanced()
    light = Light.default()  # Directional light with ambient component
    renderer = VolumeRenderer(
        width=IMAGE_RES,
        height=IMAGE_RES,
        config=config,
        light=light
    )

    # Load the volume into the renderer
    renderer.load_volume(volume)

    # Step 3: Configure the camera
    # Using front view preset at distance 3.0 for good framing
    camera = Camera.front_view(distance=3.0)
    renderer.set_camera(camera)
    print("Renderer configured")
```

### Task 5: Implement transfer functions
**Action:** Add transfer function configuration.

**Content to add in main():**
```python
    # Step 4: Set up transfer functions
    # Transfer functions map volume data values to colors and opacity

    # Color transfer function: viridis colormap (purple to yellow)
    ctf = ColorTransferFunction.from_colormap('viridis')

    # Opacity transfer function: linear from transparent to semi-opaque
    # Values: min_opacity=0.0 (fully transparent), max_opacity=0.1 (10% opaque)
    otf = OpacityTransferFunction.linear(0.0, 0.1)

    renderer.set_transfer_functions(ctf, otf)
```

### Task 6: Implement rendering and display
**Action:** Add render call and matplotlib display.

**Content to add in main():**
```python
    # Step 5: Render the volume
    print("Rendering...")
    data = renderer.render()

    # Convert raw bytes to numpy array for display
    # Renderer returns RGBA data as bytes, reshape to image dimensions
    image = np.frombuffer(data, dtype=np.uint8).reshape((IMAGE_RES, IMAGE_RES, 4))

    # Step 6: Display the result
    print("Displaying result...")
    plt.figure(figsize=(8, 8))
    plt.imshow(image, origin='lower')
    plt.title('Basic Volume Rendering - Sphere Dataset')
    plt.axis('off')
    plt.tight_layout()
    plt.show()

    print("Rendering complete!")
```

### Task 7: Add main guard
**Action:** Add standard Python main guard.

**Content to add:**
```python


if __name__ == "__main__":
    main()
```

## Verification

### Step 1: Verify file exists and is executable
```bash
# Check file exists
ls -la example/basic_rendering.py

# Verify it's a Python file
file example/basic_rendering.py
```

### Step 2: Verify syntax
```bash
# Check for syntax errors
python -m py_compile example/basic_rendering.py
```

### Step 3: Run the example
```bash
# Execute the example
python example/basic_rendering.py
```

**Expected output:**
- Console prints: "Creating volume data...", "Volume created: (128, 128, 128)", etc.
- Matplotlib window opens showing rendered sphere
- Sphere appears with viridis coloring (purple to yellow gradient)
- No errors or warnings

## Validation

### Integration Testing
```bash
# Run with Python environment
python example/basic_rendering.py

# Should complete without errors
# Should display matplotlib window with rendered sphere
```

### Visual Validation
- [ ] Sphere is centered in the image
- [ ] Colors show viridis colormap (purple to yellow)
- [ ] Image is smooth without artifacts
- [ ] Window title shows "Basic Volume Rendering - Sphere Dataset"

### Code Quality Checks
- [ ] ABOUTME headers present (2 lines)
- [ ] Docstring explains what example shows
- [ ] All imports grouped correctly (stdlib, third-party, pyvr)
- [ ] Constants use UPPER_CASE naming
- [ ] Heavy inline comments explain each step
- [ ] No version references or temporal language
- [ ] Simple variable names (volume, renderer, camera)
- [ ] ~60 lines total (Â±10 lines acceptable)

### Edge Cases
- **No display available**: Example requires display for matplotlib
- **Missing dependencies**: Should fail clearly if packages not installed

## Acceptance Criteria

- [ ] `example/basic_rendering.py` created
- [ ] File has ABOUTME headers (2 lines)
- [ ] File has complete docstring
- [ ] All imports are correct and grouped
- [ ] Constants defined at module level
- [ ] Heavy inline comments throughout (~1 comment per 2-3 lines of code)
- [ ] No version references (no "v0.2.6", "new in", etc.)
- [ ] No temporal language (no "old", "improved", "enhanced", etc.)
- [ ] Simple, descriptive variable names
- [ ] Example runs without errors
- [ ] Example displays rendered sphere with viridis colors
- [ ] Code is ~60 lines (Â±10 lines)
- [ ] Print statements show progress
- [ ] Follows design template exactly

## Git Commit

**Commit message:**
```
feat(examples): Add basic_rendering.py example

Minimal complete rendering pipeline demonstrating:
- Volume creation with synthetic sphere dataset
- Renderer setup with balanced quality preset
- Camera and lighting configuration
- Transfer function application (viridis + linear opacity)
- Rendering and matplotlib display

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

**Files to commit:**
- `example/basic_rendering.py`

**Command:**
```bash
git add example/basic_rendering.py
git commit -m "$(cat <<'EOF'
feat(examples): Add basic_rendering.py example

Minimal complete rendering pipeline demonstrating:
- Volume creation with synthetic sphere dataset
- Renderer setup with balanced quality preset
- Camera and lighting configuration
- Transfer function application (viridis + linear opacity)
- Rendering and matplotlib display

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```
