# PyVR v0.2.6 Release Notes: RenderConfig

**Release Date**: 2025-10-28
**Focus**: Rendering Configuration & Quality Presets

## 🎯 Overview

Version 0.2.6 introduces the `RenderConfig` class, providing easy-to-use quality presets and completing the pipeline-aligned architecture by separating rendering configuration from the renderer constructor.

## ✨ New Features

### RenderConfig Class

A new configuration class for managing rendering quality and performance parameters:

```python
from pyvr.config import RenderConfig
from pyvr.moderngl_renderer import VolumeRenderer

# Use quality presets
config = RenderConfig.fast()          # Fast rendering
config = RenderConfig.balanced()       # Default balance
config = RenderConfig.high_quality()   # High quality
config = RenderConfig.preview()        # Very fast preview
config = RenderConfig.ultra_quality()  # Maximum quality

renderer = VolumeRenderer(config=config)
```

### Quality Presets

Five built-in quality presets with clear tradeoffs:

| Preset | Step Size | Max Steps | Est. Speed | Use Case |
|--------|-----------|-----------|------------|----------|
| `preview()` | 0.05 | 50 | ~15x faster | Quick iteration |
| `fast()` | 0.02 | 100 | ~5x faster | Interactive exploration |
| `balanced()` | 0.01 | 500 | 1x (baseline) | General use (default) |
| `high_quality()` | 0.005 | 1000 | ~5x slower | Final renders |
| `ultra_quality()` | 0.001 | 2000 | ~20x slower | Publication quality |

### Custom Configuration

```python
# Create custom config
config = RenderConfig(
    step_size=0.015,
    max_steps=300,
    early_ray_termination=True,
    opacity_threshold=0.95
)

# Modify presets
config = RenderConfig.balanced().with_step_size(0.008)
config = RenderConfig.fast().with_max_steps(200)
```

### Runtime Configuration

```python
# Change configuration during runtime
renderer.set_config(RenderConfig.fast())
renderer.set_config(RenderConfig.high_quality())

# Get current configuration
current_config = renderer.get_config()
```

### Performance Estimation

```python
config = RenderConfig.high_quality()
samples = config.estimate_samples_per_ray()      # ~346
relative_time = config.estimate_render_time_relative()  # ~5.0x
```

## 🔧 API Changes

### VolumeRenderer Constructor

**New Signature:**
```python
VolumeRenderer(
    width=512,
    height=512,
    config=None,  # NEW: RenderConfig parameter
    light=None
)
```

**Old (v0.2.5 and earlier):**
```python
VolumeRenderer(
    width=512,
    height=512,
    step_size=0.01,  # REMOVED
    max_steps=200,   # REMOVED
    light=None
)
```

### New Methods

- `VolumeRenderer.set_config(config)` - Set rendering configuration
- `VolumeRenderer.get_config()` - Get current configuration

### Removed Methods

The following methods were removed (no backward compatibility):

- ❌ `set_step_size(step_size)` - Use `set_config()` instead
- ❌ `set_max_steps(max_steps)` - Use `set_config()` instead

## 📦 Migration Guide

### Before (v0.2.5)

```python
from pyvr.moderngl_renderer import VolumeRenderer

renderer = VolumeRenderer(
    width=512,
    height=512,
    step_size=0.01,
    max_steps=500
)

# Change parameters
renderer.set_step_size(0.005)
renderer.set_max_steps(1000)
```

### After (v0.2.6)

```python
from pyvr.moderngl_renderer import VolumeRenderer
from pyvr.config import RenderConfig

# Use preset
renderer = VolumeRenderer(
    width=512,
    height=512,
    config=RenderConfig.balanced()
)

# Change configuration
renderer.set_config(RenderConfig.high_quality())
```

## 🏗️ Architecture Improvements

### Complete Pipeline Alignment

v0.2.6 completes the rendering pipeline architecture:

```
Application Stage:
├── Volume (data, bounds) ✅ v0.2.5
├── Camera (view, projection) ✅ v0.2.3
├── Light (position, intensity) ✅ v0.2.4
├── TransferFunctions (color, opacity) ✅
└── RenderConfig (step_size, max_steps) ✅ v0.2.6

Geometry Stage:
└── Camera.get_view_matrix() ✅
└── Camera.get_projection_matrix() ✅

Rasterization Stage:
└── RenderConfig (quality settings) ✅ v0.2.6

Fragment Stage:
└── Shaders (volume.frag.glsl) ✅

Backend:
└── ModernGLManager ✅
```

**Pipeline Alignment: 100%** 🎉

## 📊 Testing

- **Total Tests**: 213 (was 172 in v0.2.5)
  - Added 33 RenderConfig unit tests
  - Added 8 integration tests
- **Test Coverage**: 86% overall
  - RenderConfig: 100%
  - ModernGL Renderer: 98%
- **All Tests Passing**: ✅

## 📝 Examples Updated

All examples updated to use `RenderConfig`:

- `multiview_example.py` - Uses `RenderConfig.high_quality()`
- `rgba_demo.py` - Uses `RenderConfig.high_quality()`
- `enhanced_camera_demo.py` - Uses `RenderConfig.high_quality()`
- `benchmark.py` - **NEW**: Compares all quality presets

### New Benchmark Example

Run the benchmark to compare quality presets:

```bash
python example/benchmark.py
```

Sample output:
```
============================================================
PyVR v0.2.6 Performance Benchmark
Comparing RenderConfig Quality Presets
============================================================

Testing Preview...      ✓ 3.21 ms (311.5 FPS)
Testing Fast...         ✓ 8.42 ms (118.8 FPS)
Testing Balanced...     ✓ 15.67 ms (63.8 FPS)
Testing High Quality... ✓ 52.34 ms (19.1 FPS)

Preset          Mean (ms)    Std (ms)  FPS     Speedup
------------------------------------------------------------
Preview          3.21 ± 0.12  311.5    4.88x
Fast             8.42 ± 0.28  118.8    1.86x
Balanced        15.67 ± 0.45   63.8    1.00x
High Quality    52.34 ± 1.23   19.1    0.30x
```

## 🔬 Technical Details

### RenderConfig Parameters

- `step_size` (float): Ray marching step size in normalized volume space
- `max_steps` (int): Maximum ray marching steps per ray
- `early_ray_termination` (bool): Enable early ray termination optimization
- `opacity_threshold` (float): Opacity threshold for early termination (0.0-1.0)

### Validation

RenderConfig includes comprehensive validation:

- `step_size` must be > 0
- `max_steps` must be >= 1
- `opacity_threshold` must be in [0.0, 1.0]
- Warnings for unusual values (step_size > 1.0, max_steps > 10000)

### Immutable Modifications

RenderConfig provides immutable modification methods:

```python
# Original config unchanged
original = RenderConfig.balanced()
modified = original.with_step_size(0.005)
assert original.step_size == 0.01  # Unchanged
assert modified.step_size == 0.005  # New value
```

## 📚 Documentation

- README.md updated with RenderConfig section
- All examples updated
- Comprehensive docstrings
- API reference complete

## 🎓 Benefits

1. **User-Friendly**: Easy quality selection without understanding ray marching parameters
2. **Simplified Constructor**: Renderer constructor now has 3 parameters instead of 5
3. **Performance Visibility**: Users understand speed/quality tradeoffs
4. **Pipeline Alignment**: Complete separation of concerns
5. **Extensibility**: Easy to add adaptive step size, progressive rendering in future versions

## 🔮 Future Plans

The RenderConfig foundation enables future features:

- **v0.3.x**: Adaptive step sizing based on gradient
- **v0.3.x**: Progressive rendering for interactive exploration
- **v0.4.x**: Multi-pass rendering configurations
- **v0.4.x**: Custom sampling strategies

## 📖 Version History

This release completes the 4-phase refactoring roadmap (v0.2.3 → v0.2.6):

- **v0.2.3**: Camera refactoring - Spherical coordinates and matrix generation
- **v0.2.4**: Light refactoring - Directional and point light presets
- **v0.2.5**: Volume refactoring - Backend-agnostic data management
- **v0.2.6**: RenderConfig - Quality presets and rendering configuration ← **Current**

## 🚀 Getting Started

```python
from pyvr.config import RenderConfig
from pyvr.moderngl_renderer import VolumeRenderer
from pyvr.camera import Camera
from pyvr.lighting import Light
from pyvr.volume import Volume
from pyvr.transferfunctions import ColorTransferFunction, OpacityTransferFunction
from pyvr.datasets import create_sample_volume, compute_normal_volume
import numpy as np

# Create volume
volume_data = create_sample_volume(256, 'double_sphere')
normals = compute_normal_volume(volume_data)
volume = Volume(
    data=volume_data,
    normals=normals,
    min_bounds=np.array([-1.0, -1.0, -1.0]),
    max_bounds=np.array([1.0, 1.0, 1.0])
)

# Setup rendering
camera = Camera.from_spherical(distance=3.0, azimuth=np.pi/4, elevation=np.pi/6)
light = Light.directional(direction=[1, -1, 0], ambient=0.2, diffuse=0.8)
config = RenderConfig.high_quality()

# Create renderer
renderer = VolumeRenderer(width=512, height=512, config=config, light=light)
renderer.load_volume(volume)
renderer.set_camera(camera)

# Set transfer functions
ctf = ColorTransferFunction.from_colormap('viridis')
otf = OpacityTransferFunction.linear(0.0, 0.1)
renderer.set_transfer_functions(ctf, otf)

# Render
data = renderer.render()
```

## 📞 Support

- **Issues**: https://github.com/JixianLi/pyvr/issues
- **Documentation**: See README.md
- **Examples**: See `example/` directory

---

**PyVR v0.2.6** - Pipeline-aligned volume rendering with quality presets 🎨
